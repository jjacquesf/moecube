version: '{build}'

platform: x86

environment:
  priv_key:
    secure: ek1AH0N8/KF6VoildmkHnu4TY1yBZcptm20AesAOanRSSGLFqkXeRxL80mHSXtiVY8ggtQNsEQR4M69gCiw1OPVWz4OAN6Vg6id6kho9GqYxWCdADbmffSNPB5leksRGjGmkAF99WHiOIZrLRUb6Bia91Fe5+SngPhI01GDDUZA2urv9x50uBBhc+kvV0bv7J5TeXDGr7tfZ3J2aL/3tf/WPqBkqjWlGAj99HTWpkIiQgwaBHoyBvEFD0uHa1BdSmI7PySGabbx4/4zqyGkO38Ce7t/Ntu/dgedzVxlXYfuiXDI8caAPZSVsJ9E2S3VKesZJzHtV9KM/8Xq0RFPythdC/qTvd2e3IAZGudZpgbUHGAHLJnCzn189Zm+Qle8CbbVuPNDcf1B/G/XwEU2MsDXGkF/kFxdeqbHgjzneyns=
  BT_TOKEN:
    secure: VNRwtuHDHJQS0UbCW2WmNSyyRtKhYPC5FCZztllsIygyg3dj5H/YY89UUmPW9vU7
  GH_TOKEN:
    secure: dAqGTWGo387j9Kaot54scDTRWzXGb3DBVPVcOIzQhNAvSt3WCvXA6xBYIFvPH4pQ
  CSC_LINK:
    secure: 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
#  npm_config_target: 1.4.10 # 在下面 install 里动态获取
  npm_config_arch: ia32
  npm_config_target_arch: ia32
  npm_config_disturl: https://atom.io/download/atom-shell
  npm_config_runtime: electron
  npm_config_build_from_source: true

cache:
  - node_modules -> package.json
  - '%APPDATA%\npm-cache -> package.json'
  - '%USERPROFILE%\.electron -> package.json'

shallow_clone: true

init:
  # - ps: iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
  - ps: $fileContent = "-----BEGIN EC PRIVATE KEY-----`n"
  - ps: $fileContent += $env:priv_key.Replace(' ', "`n")
  - ps: $fileContent += "`n-----END EC PRIVATE KEY-----`n"
  - ps: Set-Content c:\users\appveyor\.ssh\id_ecdsa $fileContent

# on_finish:
#  - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))

install:
  - set PATH=%PATH%;C:\cygwin\bin # curl, tar xz
  - mkdir -p bin
  - curl --location --retry 5 --output aria2-1.29.0-win-32bit-build1.zip https://github.com/aria2/aria2/releases/download/release-1.29.0/aria2-1.29.0-win-32bit-build1.zip
  - unzip -o aria2-1.29.0-win-32bit-build1.zip aria2-1.29.0-win-32bit-build1/aria2c.exe
  - mv aria2-1.29.0-win-32bit-build1/aria2c.exe bin
  - rm -rf aria2-1.29.0-win-32bit-build1 aria2-1.29.0-win-32bit-build1.zip
  - curl --location --retry 5 "http://downloads.sourceforge.net/project/msys2/REPOS/MSYS2/i686/bsdtar-3.2.1-1-i686.pkg.tar.xz" | tar --strip-components=2 -C bin -Jxf - usr/bin/bsdtar.exe
  - curl --location --retry 5 "http://downloads.sourceforge.net/project/msys2/Base/i686/msys2-base-i686-20161025.tar.xz" | tar --strip-components=3 -C bin -Jxf - msys32/usr/bin/msys-2.0.dll msys32/usr/bin/msys-bz2-1.dll msys32/usr/bin/msys-gcc_s-1.dll msys32/usr/bin/msys-iconv-2.dll msys32/usr/bin/msys-lzma-5.dll msys32/usr/bin/msys-lzo2-2.dll msys32/usr/bin/msys-nettle-6.dll msys32/usr/bin/msys-xml2-2.dll msys32/usr/bin/msys-z.dll msys32/usr/bin/sha256sum.exe msys32/usr/bin/msys-intl-8.dll

  - ps: Install-Product node
  - npm show electron version > %temp%\electron-version.txt
  - set /p npm_config_target= < %temp%\electron-version.txt
  - npm install
  - npm prune

build_script:
  - npm run dist
